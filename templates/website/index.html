{% extends 'website/base.html' %}


{% block title %} SQLVIZ Homepage {% endblock %}
{% load staticfiles %}
{% block style %}

{% endblock %}
{% block main %}
  <div align='center' padding='3px'><button align='right' type="submit" id="toggle_table" class="btn btn-info">Show Images</button>
  </div>

<script>
  $(document).ready(function() {
    $('#toggle_table').click(function() {
      $("#table_group").toggleClass("hide");
      $("#img_group").toggleClass("hide");
      if ($.trim($(this).text()) === 'Show Images') {
        $(this).text('Show Table');
      } else {
        $(this).text('Show Images');
      }
    });
  });
</script>
<div id='table_group'>

{% if query_list or dashboard_list %}
    <table id='query_list_table' class="table table-striped dataTable">
      <thead>
        <tr>
          <td> ID </td>
          <td> Fav </td>
          <td> Title </td>
          <td> Description </td>
          <td> Thumbnail </td>
          <td> Owner </td>
          <td> Target DB </td>
          <td> Tags </td>
          {% if user.is_staff %}
            <td> Edit </td>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for query in query_list %}
        <tr>
          <td> Q{{query.id}} </td>
          <td> <a object_id='{{query.id}}' target_model='website.Query' href='javascript:' class='star {% if query.fav %}favorite{% endif %}'>{{query.fav}} </a></td>
          <td> <a href="{% url 'website:query' query.id %}">{{query.title}} </a></td>
          <td> 
            {% if query.image %}
              <a href="{% url 'website:query' query.id %}">
                <img src='{{query.image}}' width = '80px' height = '132px' alt='image for query {{query.id}}'>
              </a>
            {% endif %}
          </td>
          <td> {{query.description}}  {{query.description_long}}</td>
          <td> {{query.tags.names|join:", " }} </td>
          <td> {{query.owner}} </td>
          <td> {{query.db}} </td>

          {% if user.is_staff %}
            <td> <a href="{% url 'admin:website_query_change' query.id %}">Edit</a> </td>
          {% endif %}
        </tr>   
        {% endfor %}
        {% for dash in dashboard_list %}
          <tr>
          <td> D{{dash.id}} </td> 
          <td> <a object_id='{{dash.id}}' target_model='website.Dashboard' href='javascript:' class='star {% if dash.fav %}favorite{% endif %}'>{{dash.fav}}</a> </td>
          <td> <a href="{% url 'website:dashboard' dash.id %}">{{dash.title}} </a></td>
          <td><!-- image --> </td>
          <td> {{dash.create_time}} </td>
          <td> {{dash.description}}  {{dash.description_long}}</td>
          <td><!-- database --></td>
          <td>  {{ dash.tags.names|join:", " |truncatechars_html:4 }} </td>
          {% if user.is_staff %}
            <td> <a href="{% url 'admin:website_dashboard_change' dash.id %}">Edit</a> </td>
          {% endif %}
        </tr>  
        </tr>      
        {% endfor %}        
      </tbody>
    </table>
    <script>
    $(document).ready(function() {
      $('#query_list_table').dataTable({
        "bAutoWidth": false,
        "bScrollCollapse": true,
        "iDisplayLength": 100,
        "tableTools": {
          "sSwfPath": "{% static 'DataTables-1.10.2/extensions/TableTools/swf/copy_csv_xls_pdf.swf' %}"
        },
        "columnDefs": [
          {
            "visible": false,
            "targets": 10
          }
        ] 
      });
    } );
    </script>
{% else %}
    <p>No Queries or Dashboards are available.</p>
{% endif %}
</div>
{% if 1 == 1 %}
<div id='img_group' class='hide'>
  {% if query_list or dashboard_list %}
    {% for query in query_list %}
      {% if query.image %}
        <div class='col-lg-3'>
          <a object_id='{{query.id}}' target_model='website.Query' href='javascript:' class='star {% if query.fav %}favorite{% endif %}'>{{query.fav}}</a>
          <a href="{% url 'website:query' query.id %}">
           Q{{query.id}} - {{query.title}} 
          <img src='{{query.image}}' width = '200px' height = '200px' alt='{{query.description}}  {{query.description_long}}'>
          </a>
        </div>
      {% endif %}
    {% endfor %}
  {% else %}
      <p>No Queries Images available.</p>
  {% endif %}
</div>
{% endif %}
<script>
  make_favorites('{% url 'favs:add' %}','{% url 'favs:remove' %}');
</script>
{% endblock %}
