{% extends 'website/base.html' %}
{% load staticfiles %}

{% block title %} 
  Interactive Mode
{% endblock %}

{% block links %}
<ul>
  <li><a href="/">Home</a></li>
  <li><a href="">Query Live</a></li>
  <li><a href="/admin/">Admin</a></li>
  <li><a href="/website/query/{% with query_list|first as first_query %}{{ first_query.id }}{% endwith %}">Edit</a></li>
  <li class="active"><a href="/website/query_interactive/">Interactive Mode</a></li>
</ul>
{% endblock %}

{% block main %}
<script type="text/javascript" src="{% static 'js/make_chart.js' %}"></script>
<script type="text/javascript" src="{% static 'Highcharts-4.0.3/js/highcharts.js' %}"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>

<div id='sortable'>
    <div class='jumbotron'>
    <h2>Interactive Query Mode</h2>
    <table class='table table-striped' id = 'table'></table>
    <div id="error_{{query.id}}" class = "alert alert-error alert-block"></div>
    </div>
    <div id ='chart_{{query.id}}'></div>
    <form action='TODO'>
      <p>
        <select id="db">
          <h4>DB</h4>
          {% for db in db_list%}
            <option value="{{db.id}}">{{db.title}}</option>

        {% endfor %}
        </select>
      </p>
      <p><h4>Pivot </h4>
        <input type='radio' name='pivot' id='pivot' value='True' label='True'>True
        <input type='radio' name='pivot'  id='pivot' value='False' label='False'>False
      </p>

      <p><h4>Graph</h4>
        <input type='radio' name='graph' id='graph' value='None' label='None'>None
        <input type='radio' name='graph' id='graph' value='Line' label='Line'>Line
        <input type='radio' name='graph' id='graph' value='Bar' label='Bar'>Bar
        <input type='radio' name='graph' id='graph' value='Column' label='Column'>Column
        <input type='radio' name='graph' id='graph' value='Scatter' label='Scatter'>Scatter
      </p>
        <textarea></textarea>
        <div id='sql_area'></div> <!-- TODO get ACE working here -->               

      <button type="submit" class="btn btn-primary">Run</button>
    </form>
    <script>
    // TODO function which grabs parts of form submission
     data = {'pivot': pivot, 'db' : db, 'query_text': query_text}
     $.postJSON('/query_interactive_api',data, function( json_data ) {
      //TODO add URL reverse here
      console.log(json_data);
      console.log('chart_{{query.id}}');
      $( "#waiting_{{query.id}}" ).empty();
      if (json_data.error == false){
        make_table(json_data.data.columns, json_data.data.data, '#table');  
        make_chart(json_data.data.columns, json_data.data.data, 'chart', 'False', graph, 'Interactive Query Mode', 'Xaxis Title', 'yAxis Title' ,'False');
          };          
      } else {
        $( "#error" ).text(json_data.data)
      }
    });
    </script>
{% endblock %}